<html> 
    <head> 
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/> 
        <title>Particle system</title> 
        <script type="text/javascript" src="../kernel/Settings.js"></script>
        <script type="text/javascript" src="../kernel/Time.js"></script>
        <script type="text/javascript" src="../kernel/Input.js"></script>
        <script type="text/javascript" src="../kernel/Application.js"></script>
        <script type="text/javascript" src="../kernel/Utils.js"></script>
        <script type="text/javascript" src="../kernel/Script.js"></script>
        <script type="text/javascript" src="../kernel/GameObject.js"></script>
		<script type="text/javascript" src="../kernel/ImageDB.js"></script>
        <script type="text/javascript" src="../components/ParticleSystem.js"></script>

        <script type="text/javascript">
            /**
             * ImageDB test screen level.
             * 
             * 
             * @author Thiago Campos Viana
             */
            ImageDBTest.prototype = new GameObject;
            function ImageDBTest() {
				Settings.showFPS=false;
                this.name="ImageDBTest";
				this.height=20;

				this.position=0;
				this.updateRate=0.3;
				this.nextUpdate = this.updateRate;
				
                this.start=function(){		
                    ImageDB.load(['http://apps.tutei.com/engine/res/charsheet.png','http://apps.tutei.com/engine/res/html5mud.png',
									'http://apps.tutei.com/engine/res/icon.png']);
					Settings.screenColor='#000';
					
					//this.posY=Application.canvas.height/2-this.height/2;
					//this.posY=Application.canvas.height-this.height*2;
					this.posY=this.height*3;
                },
	


                this.update=function() {	
					console.log(Math.round(100*ImageDB.percentLoaded()));
					

					this.nextUpdate-=Time.deltaTime;

					if (this.nextUpdate>0) return 0;

					this.nextUpdate = this.updateRate;
					
					if( this.position < 3 ){
						this.position++;
					} else {
						this.position=0;
					}
				}
				
				this.render=function(g){
					g.font = "bold 14pt Monospace";
					g.fillStyle = "#fff"; // text color
					var extra='';
					for (var x = 0;x < this.position; x++) extra+='.';
					var percent=ImageDB.percentLoaded();
					g.fillText("Loading(" +Math.round(100*percent)+ "%)" + extra, 10, this.posY-this.height);
					g.fillText("tutei.com", Application.canvas.width-110, Application.canvas.height-20);
					
					g.fillStyle = "rgba(255, 255, 255, 0.5)";

					g.beginPath();
					g.rect(10,this.posY, Application.canvas.width - 20, this.height);
					g.closePath();
					g.lineWidth = 4;
					g.strokeStyle = "#00ff00";
					g.stroke();
					g.fill();
					
					g.fillStyle = "rgba(55, 255, 255, 1.0)";

					g.beginPath();
					g.rect(10,this.posY, Math.round((Application.canvas.width-20)*percent), this.height);
					g.closePath();
					g.fill();
				
				
				
				}


            }







        </script>
    </head> 
    <body id="home"> 
        <canvas id="canvas" width="320" height="480"></canvas>
        <script type="text/javascript">
            Application.run('canvas','ImageDBTest',320,480);			
        </script>	
    </body> 
</html>  			